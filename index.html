<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å‹™å¼•è–¦è‡ªå‹•æ’ç‰ˆç³»çµ± (Tailwind ç¾è§€ç‰ˆ)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Html2Canvas for Screenshot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f2f5;
            overflow: hidden;
        }
        
        .card-shadow {
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        /* V1 Layout Styles */
        .industry-text {
            color: #d32f2f;
            font-weight: 700;
        }
        .label-text {
            color: #666;
            font-weight: 500;
        }
        .next-one-text {
            color: #d32f2f;
            font-weight: 700;
        }
        .profile-mask {
            border-radius: 1.5rem; /* rounded-3xl approx */
            overflow: hidden;
            aspect-ratio: 1/1;
            background-color: #e0e0e0;
        }

        /* V2 Layout Styles (Overview) */
        .v2-name {
            color: #4b5563; /* gray-600 */
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 0.5rem; 
            text-align: center;
            line-height: 1.4;
            display: block;
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            width: 100%;
        }
        .v2-industry {
            color: #d32f2f;
            font-weight: 700;
            font-size: 1rem;
            margin-top: 0.5rem; 
            text-align: center;
            line-height: 1.4;
            display: block;
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            width: 100%;
        }
        .v2-photo-mask {
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 1rem; 
            overflow: hidden;
            background-color: #e0e0e0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Controls & UI */
        #controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 1.5rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 50;
            border-top: 1px solid #444;
        }
        
        #controls.visible {
            transform: translateY(0);
        }

        #post-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        #post-modal.flex {
            display: flex;
        }

        .edit-area {
            width: 100%;
            background: #2d2d2d;
            color: #e5e7eb;
            font-family: monospace;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            resize: none;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 16px;
            height: 16px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center relative bg-[#f0f2f5]">

    <!-- Capture Area -->
    <div id="capture-area" class="w-full h-full flex flex-col items-center justify-center p-4 pt-16 bg-[#f0f2f5]">
        
        <!-- LAYOUT V1: Detail View (2 Cards) -->
        <div id="layout-v1" class="w-full max-w-7xl flex flex-col items-center transition-opacity duration-300">
            <div class="w-full flex gap-8 items-start justify-center mt-8">
                <!-- Left Card -->
                <div class="flex-1 max-w-xl relative group">
                    <div class="absolute -top-16 left-4 text-5xl font-bold text-gray-400" id="idx-0">01</div>
                    <div class="bg-white rounded-3xl p-8 card-shadow h-full flex flex-col relative">
                        
                        <div class="flex gap-6 mb-6">
                            <div class="w-40 h-40 flex-shrink-0 profile-mask shadow-sm">
                                <img id="img-0" src="" alt="Profile" class="w-full h-full object-cover">
                            </div>
                            <div class="flex flex-col justify-center pt-8">
                                <h2 class="text-4xl font-bold text-gray-800 mb-2 tracking-wide" id="name-0">å§“å</h2>
                                <p class="text-xl text-gray-500 font-medium">é‚€è«‹äººï¼š<span id="inviter-0">---</span></p>
                            </div>
                        </div>
                        <div class="space-y-2 text-lg leading-relaxed">
                            <div><span class="label-text">ç”¢æ¥­åˆ¥ï¼š</span><span class="industry-text" id="industry-0">---</span></div>
                            <div><span class="label-text">å…¬å¸åç¨±ï¼š</span><span class="text-gray-600" id="company-0">---</span></div>
                            <div><span class="label-text">å¸Œæœ›åˆä½œçš„ç”¢æ¥­åˆ¥ï¼š</span><span class="text-gray-600" id="coop-0">---</span></div>
                        </div>
                    </div>
                </div>

                <!-- Right Card -->
                <div class="flex-1 max-w-xl relative group">
                    <div class="absolute -top-16 left-4 text-5xl font-bold text-gray-400" id="idx-1">02</div>
                    <div class="bg-white rounded-3xl p-8 card-shadow h-full flex flex-col relative invisible"> <!-- Initially invisible -->
                        
                        <div class="flex gap-6 mb-6">
                            <div class="w-40 h-40 flex-shrink-0 profile-mask shadow-sm">
                                <img id="img-1" src="" alt="Profile" class="w-full h-full object-cover">
                            </div>
                            <div class="flex flex-col justify-center pt-8">
                                <h2 class="text-4xl font-bold text-gray-800 mb-2 tracking-wide" id="name-1">å§“å</h2>
                                <p class="text-xl text-gray-500 font-medium">é‚€è«‹äººï¼š<span id="inviter-1">---</span></p>
                            </div>
                        </div>
                        <div class="space-y-2 text-lg leading-relaxed">
                            <div><span class="label-text">ç”¢æ¥­åˆ¥ï¼š</span><span class="industry-text" id="industry-1">---</span></div>
                            <div><span class="label-text">å…¬å¸åç¨±ï¼š</span><span class="text-gray-600" id="company-1">---</span></div>
                            <div><span class="label-text">å¸Œæœ›åˆä½œçš„ç”¢æ¥­åˆ¥ï¼š</span><span class="text-gray-600" id="coop-1">---</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer Next One -->
            <div class="mt-12 w-full text-center">
                <div class="text-2xl">
                    <span class="next-one-text">>>Next one:</span>
                    <span class="text-gray-600 font-bold ml-2" id="next-names">---</span>
                </div>
            </div>
        </div>

        <!-- LAYOUT V2: Summary View (Grid of 7) -->
        <div id="layout-v2" class="w-full max-w-[1600px] hidden flex-col items-center justify-center h-full">
            <!-- V2 Container: A row of 7 items -->
            <div id="v2-container" class="w-full grid grid-cols-7 gap-6 px-4 pt-8">
                <!-- Template for JS to populate -->
            </div>
        </div>

    </div>
    <!-- End Capture Area -->

    <!-- Toggle Button -->
    <button onclick="toggleControls()" class="fixed top-4 right-4 bg-gray-800 text-white p-2 rounded-full hover:bg-gray-700 z-50 opacity-30 hover:opacity-100 transition-opacity">
        <i class="fa-solid fa-gear"></i>
    </button>

    <!-- Controls Panel -->
    <div id="controls">
        <div class="flex gap-6 items-start">
            <!-- Left: Google Sheet Settings -->
            <div class="w-1/3 border-r border-gray-700 pr-6">
                <h3 class="font-bold mb-3 text-lg text-green-400"><i class="fa-solid fa-file-csv"></i> Google Sheet åŒæ­¥</h3>
                <div class="mb-2">
                    <label class="block text-xs text-gray-400 mb-1">Sheet URL (æ¬Šé™éœ€è¨­ç‚º: çŸ¥é“é€£çµè€…çš†å¯æª¢è¦–)</label>
                    <input type="text" id="sheet-url" class="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-xs" 
                           placeholder="https://docs.google.com/spreadsheets/d/.../edit..."
                           value="https://docs.google.com/spreadsheets/d/1vJVk6GCKLAFcQ0lAaMk2wX2iehWqHEBaAoYei9IV2zc/edit?gid=48048883#gid=48048883">
                </div>
                <button onclick="fetchGoogleSheet()" id="btn-fetch" class="bg-red-600 hover:bg-red-700 text-white w-full py-2 rounded font-bold flex items-center justify-center gap-2">
                    <i class="fa-solid fa-cloud-arrow-down"></i> è¼‰å…¥ Sheet è³‡æ–™
                </button>
                <div id="fetch-status" class="text-xs text-gray-400 h-4 mt-1"></div>
            </div>

            <!-- Middle: Layout & Export -->
            <div class="w-1/3 border-r border-gray-700 pr-6 flex flex-col gap-3">
                <h3 class="font-bold text-gray-300">é¡¯ç¤ºæ¨¡å¼ & åŒ¯å‡º</h3>
                
                <div class="flex gap-2 w-full">
                    <button onclick="switchLayout('v1')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-bold flex items-center justify-center gap-2" id="btn-v1">
                        <i class="fa-solid fa-user-group"></i> è©³ç´°
                    </button>
                    <button onclick="switchLayout('v2')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold flex items-center justify-center gap-2" id="btn-v2">
                        <i class="fa-solid fa-users"></i> ç¸½è¦½
                    </button>
                </div>

                <div class="flex gap-2 w-full mt-1">
                     <button onclick="openPostModal()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-1 rounded text-sm flex items-center justify-center gap-2">
                        <i class="fa-brands fa-line"></i> è²¼æ–‡
                    </button>
                    <button onclick="exportToPng()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-1 rounded text-sm flex items-center justify-center gap-2">
                        <i class="fa-solid fa-camera"></i> PNG
                    </button>
                </div>
            </div>

            <!-- Right: Controls -->
            <div class="w-1/3 flex flex-col gap-3">
                <h3 class="font-bold text-gray-300">æ§åˆ¶å°</h3>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="prevSlide()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold flex items-center justify-center gap-2"><i class="fa-solid fa-chevron-left"></i> ä¸Šä¸€é </button>
                    <button onclick="nextSlide()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 rounded font-bold flex items-center justify-center gap-2">ä¸‹ä¸€é  <i class="fa-solid fa-chevron-right"></i></button>
                </div>
                <div class="mt-auto text-xs text-gray-400">
                    éµç›¤æ“ä½œï¼š â†’ ä¸‹ä¸€é  / â† ä¸Šä¸€é 
                </div>
            </div>
        </div>
    </div>

    <!-- Post Generation Modal -->
    <div id="post-modal">
        <div class="bg-gray-800 p-6 rounded-xl w-full max-w-2xl shadow-2xl transform scale-100">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">ğŸ“‹ ç¤¾ç¾¤è²¼æ–‡ç”¢ç”Ÿå™¨</h3>
                <button onclick="closePostModal()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            <p class="text-gray-400 text-sm mb-2">ä»¥ä¸‹å·²å°‡æ‰€æœ‰è³‡æ–™è½‰æ›ç‚ºè²¼æ–‡æ ¼å¼ï¼Œè«‹å…¨é¸è¤‡è£½ï¼š</p>
            <textarea id="post-output" class="edit-area h-64 mb-4 focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
            <div class="flex justify-end gap-2">
                <button onclick="copyPostText()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded font-bold flex items-center gap-2">
                    <i class="fa-solid fa-copy"></i> ä¸€éµè¤‡è£½
                </button>
            </div>
        </div>
    </div>

    <script>
        // é è¨­è³‡æ–™
        let presentationData = [
             {
                "id": "03",
                "name": "å¼µå“²å‰",
                "inviter": "å»–å‚‘è¼",
                "industry": "ç™¾é¦™æœç”¢æ¥­éˆ",
                "company": "é®®ç”°è‚¡ä»½æœ‰é™å…¬å¸",
                "coop": "é£Ÿå“å» /è¡ŒéŠ·é€šè·¯/æˆ°ç•¥æŠ•è³‡äºº/é€£é–é£²å“ç¸½éƒ¨",
                "photo": "https://api.dicebear.com/7.x/avataaars/svg?seed=Zhang&gender=male"
            },
            {
                "id": "04",
                "name": "é™³ä¿¡è£•",
                "inviter": "é™³å† ç¶­",
                "industry": "æ±½è»Šé‘°åŒ™çš®å¥—",
                "company": "è‡ªè¡Œå‰µæ¥­",
                "coop": "æ±½è»Šæ¥­å‹™.å»ºè¨­å…¬å¸",
                "photo": "https://api.dicebear.com/7.x/avataaars/svg?seed=Chen&gender=male"
            }
        ];

        let currentIndex = 0;
        let currentLayout = 'v1'; // 'v1' or 'v2'

        window.onload = function() {
            const savedData = localStorage.getItem('presentationData');
            const savedUrl = localStorage.getItem('googleSheetUrl');
            
            if (savedUrl) {
                document.getElementById('sheet-url').value = savedUrl;
            }

            if (savedData) {
                presentationData = JSON.parse(savedData);
            }
            
            renderSlide();
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') nextSlide();
                if (e.key === 'ArrowLeft') prevSlide();
            });
        };

        // --- Layout Switching ---
        function switchLayout(layout) {
            currentLayout = layout;
            currentIndex = 0; 
            
            const btnV1 = document.getElementById('btn-v1');
            const btnV2 = document.getElementById('btn-v2');
            
            if (layout === 'v1') {
                document.getElementById('layout-v1').style.display = 'flex';
                document.getElementById('layout-v2').style.display = 'none';
                document.getElementById('layout-v2').classList.remove('flex');
                
                btnV1.classList.remove('bg-gray-600');
                btnV1.classList.add('bg-blue-600');
                btnV2.classList.add('bg-gray-600');
                btnV2.classList.remove('bg-blue-600');
            } else {
                document.getElementById('layout-v1').style.display = 'none';
                document.getElementById('layout-v2').style.display = 'flex';
                
                btnV1.classList.add('bg-gray-600');
                btnV1.classList.remove('bg-blue-600');
                btnV2.classList.remove('bg-gray-600');
                btnV2.classList.add('bg-blue-600');
            }
            renderSlide();
        }

        // --- Google Sheet Logic ---
        function parseGoogleSheetUrl(url) {
            const idMatch = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            const id = idMatch ? idMatch[1] : null;
            const gidMatch = url.match(/[#&?]gid=([0-9]+)/);
            const gid = gidMatch ? gidMatch[1] : "0";
            return { id, gid };
        }

        async function fetchGoogleSheet() {
            const url = document.getElementById('sheet-url').value.trim();
            const statusEl = document.getElementById('fetch-status');
            const btn = document.getElementById('btn-fetch');
            
            const { id, gid } = parseGoogleSheetUrl(url);

            if (!id) {
                alert('ç„¡æ³•è§£æ Google Sheet IDï¼Œè«‹ç¢ºèªç¶²å€æ ¼å¼æ­£ç¢ºã€‚');
                return;
            }

            localStorage.setItem('googleSheetUrl', url);

            btn.innerHTML = '<div class="loader"></div> è¼‰å…¥ä¸­...';
            btn.disabled = true;
            statusEl.innerText = 'æ­£åœ¨é€£ç·šåˆ° Google...';
            statusEl.className = 'text-xs text-yellow-400 h-4 mt-1';

            // Use Google CSV Export
            const googleCsvUrl = `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`;
            
            // Fallback strategy
            const proxies = [
                (target) => `https://api.allorigins.win/raw?url=${encodeURIComponent(target)}`,
                (target) => `https://corsproxy.io/?${encodeURIComponent(target)}`
            ];

            let csvText = null;

            for (const proxyGen of proxies) {
                try {
                    const proxyUrl = proxyGen(googleCsvUrl);
                    console.log("Trying proxy:", proxyUrl);
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    csvText = await response.text();
                    
                    if (csvText && csvText.trim().startsWith("<")) {
                         throw new Error("Received HTML instead of CSV");
                    }

                    if (csvText) break; // Success
                } catch (e) {
                    console.warn("Proxy failed:", e);
                }
            }

            if (!csvText) {
                statusEl.innerText = 'è®€å–å¤±æ•—: è«‹ç¢ºèªæ¬Šé™';
                statusEl.className = 'text-xs text-red-400 h-4 mt-1';
                btn.innerHTML = '<i class="fa-solid fa-cloud-arrow-down"></i> è¼‰å…¥ Sheet è³‡æ–™';
                btn.disabled = false;
                alert("è®€å–å¤±æ•—ï¼å¯èƒ½åŸå› ï¼š\n1. Google Sheet æ¬Šé™æœªè¨­ç‚ºã€ŒçŸ¥é“é€£çµè€…çš†å¯æª¢è¦–ã€\n2. ç¶²è·¯å°é–äº†ä»£ç†ä¼ºæœå™¨");
                return;
            }

            // Parse Data
            try {
                Papa.parse(csvText, {
                    header: false, 
                    complete: function(results) {
                        const rawData = results.data;
                        
                        let headerRowIndex = -1;
                        for(let i=0; i<Math.min(20, rawData.length); i++) {
                            const rowStr = JSON.stringify(rawData[i]);
                            if (rowStr.includes("å§“å") || rowStr.includes("Name")) {
                                headerRowIndex = i;
                                break;
                            }
                        }

                        if (headerRowIndex === -1) throw new Error("æ‰¾ä¸åˆ°å«æœ‰ã€Œå§“åã€çš„æ¨™é¡Œåˆ—");

                        const headers = rawData[headerRowIndex].map(h => h.trim());
                        const findCol = (keywords) => headers.findIndex(h => keywords.some(k => h.includes(k)));
                        
                        const colMap = {
                            name: findCol(["å§“å", "Name"]),
                            inviter: findCol(["é‚€è«‹äºº", "Inviter"]),
                            industry: findCol(["ç”¢æ¥­", "Industry", "è¡Œæ¥­"]),
                            company: findCol(["å…¬å¸", "Company"]),
                            coop: findCol(["åˆä½œ", "Coop", "å°è±¡"]),
                            photo: findCol(["ç…§ç‰‡", "Photo", "Image"])
                        };

                        if (colMap.name === -1) throw new Error("æ‰¾ä¸åˆ°ã€Œå§“åã€æ¬„ä½");

                        const newData = [];
                        let idCounter = 1;

                        for(let i = headerRowIndex + 1; i < rawData.length; i++) {
                            const row = rawData[i];
                            if (!row[colMap.name] || row[colMap.name].trim() === "") continue;

                            let photoUrl = colMap.photo > -1 ? row[colMap.photo] : "";
                            
                            newData.push({
                                id: String(idCounter).padStart(2, '0'),
                                name: row[colMap.name],
                                inviter: colMap.inviter > -1 ? row[colMap.inviter] : "",
                                industry: colMap.industry > -1 ? row[colMap.industry] : "",
                                company: colMap.company > -1 ? row[colMap.company] : "",
                                coop: colMap.coop > -1 ? row[colMap.coop] : "",
                                photo: photoUrl
                            });
                            idCounter++;
                        }

                        if (newData.length === 0) throw new Error("æ²’æœ‰æŠ“å–åˆ°æœ‰æ•ˆè³‡æ–™");

                        presentationData = newData;
                        localStorage.setItem('presentationData', JSON.stringify(presentationData));
                        
                        statusEl.innerText = `æˆåŠŸè¼‰å…¥ ${newData.length} ç­†è³‡æ–™ï¼`;
                        statusEl.className = 'text-xs text-green-400 h-4 mt-1';
                        
                        currentIndex = 0;
                        renderSlide();
                        setTimeout(() => toggleControls(), 1500);
                    },
                    error: function(err) { throw err; }
                });

            } catch (error) {
                console.error(error);
                statusEl.innerText = 'è§£æå¤±æ•—: ' + error.message;
                statusEl.className = 'text-xs text-red-400 h-4 mt-1';
                alert("è³‡æ–™è§£æéŒ¯èª¤ï¼š" + error.message);
            } finally {
                btn.innerHTML = '<i class="fa-solid fa-cloud-arrow-down"></i> è¼‰å…¥ Sheet è³‡æ–™';
                btn.disabled = false;
            }
        }

        // --- Post Generation Logic ---
        function generatePostText() {
            let text = "";
            presentationData.forEach(p => {
                text += `ğŸ‘¨ ${p.name}ï½œ${p.company} ğŸ‘€\n`;
                text += `ç”¢æ¥­åˆ¥ï¼š${p.industry} ğŸ’¡\n`;
                text += `åˆä½œå°è±¡ï¼š${p.coop} ğŸ“\n`;
                text += `é‚€è«‹äººï¼š${p.inviter}\n`;
                text += `--------------------------------\n`; // Separator
            });
            return text;
        }

        function openPostModal() {
            const text = generatePostText();
            document.getElementById('post-output').value = text;
            document.getElementById('post-modal').classList.add('flex');
            toggleControls(); 
        }

        function closePostModal() {
            document.getElementById('post-modal').classList.remove('flex');
        }

        function copyPostText() {
            const textarea = document.getElementById('post-output');
            textarea.select();
            document.execCommand('copy');
            alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
        }

        function exportToPng() {
            const element = document.getElementById("capture-area");
            const controls = document.getElementById("controls");
            const btn = document.querySelector("button[onclick='toggleControls()']");
            
            // Hide UI
            controls.style.visibility = 'hidden';
            btn.style.visibility = 'hidden';

            html2canvas(element, {
                backgroundColor: "#f0f2f5", 
                scale: 2,
                scrollY: -window.scrollY 
            }).then(canvas => {
                // Restore UI
                controls.style.visibility = '';
                btn.style.visibility = '';
                const link = document.createElement('a');
                link.download = `BNI_Presentation.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // --- Core Render Logic ---
        function renderSlide() {
            if (currentLayout === 'v1') {
                renderV1();
            } else {
                renderV2();
            }
        }

        function renderV1() {
            const person1 = presentationData[currentIndex];
            const person2 = presentationData[currentIndex + 1];

            // Card 1
            if (person1) {
                updateCardV1(0, person1);
                document.getElementById('idx-0').innerText = person1.id || (currentIndex + 1).toString().padStart(2, '0');
            }

            // Card 2
            const card2El = document.getElementById('idx-1').parentElement.parentElement; // The bg-white div is the parent of parent of idx-1? No, idx-1 is inside.
            // Wait, DOM structure in Tailwind version:
            // <div class="flex-1 max-w-xl relative group"> <div class="absolute ...">02</div> <div class="bg-white ..."> ... </div> </div>
            // The "bg-white" div is the card itself.
            
            // Correct way to toggle visibility:
            // The logic used in previous Tailwind version: document.getElementById('idx-1').parentElement.style.visibility = 'visible';
            // Here idx-1 is .absolute.-top-16. Its parent is the wrapper div "relative group".
            
            if (person2) {
                document.getElementById('idx-1').parentElement.classList.remove('invisible');
                document.getElementById('idx-1').parentElement.classList.add('visible');
                updateCardV1(1, person2);
                document.getElementById('idx-1').innerText = person2.id || (currentIndex + 2).toString().padStart(2, '0');
            } else {
                document.getElementById('idx-1').parentElement.classList.remove('visible');
                document.getElementById('idx-1').parentElement.classList.add('invisible');
            }

            // Footer Next Logic
            const next1 = presentationData[currentIndex + 2];
            const next2 = presentationData[currentIndex + 3];
            let nextText = "";
            if (next1) {
                nextText = next1.name;
                if (next2) nextText += " / " + next2.name;
            } else {
                nextText = "ç”¢æ¥­åˆ†çµ„ / END"; 
            }
            document.getElementById('next-names').innerText = nextText;
        }

        function updateCardV1(idx, data) {
            document.getElementById(`name-${idx}`).innerText = data.name || "";
            document.getElementById(`inviter-${idx}`).innerText = data.inviter || "---";
            document.getElementById(`industry-${idx}`).innerText = data.industry || "---";
            document.getElementById(`company-${idx}`).innerText = data.company || "---";
            document.getElementById(`coop-${idx}`).innerText = data.coop || "---";
            
            const imgEl = document.getElementById(`img-${idx}`);
            let photoSrc = data.photo;
            if (!photoSrc || photoSrc.trim() === "") {
                photoSrc = `https://ui-avatars.com/api/?name=${data.name}&background=random&size=200&font-size=0.33`;
            }
            imgEl.src = photoSrc;
            imgEl.onerror = function() {
                this.src = `https://ui-avatars.com/api/?name=${data.name}&background=random&size=200&font-size=0.33`;
            };
        }

        function renderV2() {
            const itemsPerPage = 7;
            const container = document.getElementById('v2-container');
            container.innerHTML = ''; 

            for (let i = 0; i < itemsPerPage; i++) {
                const dataIndex = currentIndex + i;
                if (dataIndex >= presentationData.length) break;

                const data = presentationData[dataIndex];
                let photoSrc = data.photo;
                if (!photoSrc || photoSrc.trim() === "") {
                    photoSrc = `https://ui-avatars.com/api/?name=${data.name}&background=random&size=200&font-size=0.33`;
                }

                const itemHtml = `
                    <div class="flex flex-col items-center mb-4 w-full px-1">
                        <div class="v2-name truncate w-full text-center">${data.name}</div>
                        <div class="v2-photo-mask">
                            <img src="${photoSrc}" alt="${data.name}" class="w-full h-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=${data.name}&background=random&size=200&font-size=0.33'">
                        </div>
                        <div class="v2-industry truncate w-full text-center">${data.industry}</div>
                    </div>
                `;
                container.innerHTML += itemHtml;
            }
        }

        function nextSlide() {
            const step = currentLayout === 'v1' ? 2 : 7;
            if (currentIndex + step < presentationData.length) {
                currentIndex += step;
                renderSlide();
            }
        }

        function prevSlide() {
            const step = currentLayout === 'v1' ? 2 : 7;
            if (currentIndex - step >= 0) {
                currentIndex -= step;
                renderSlide();
            } else if (currentIndex > 0) {
                currentIndex = 0;
                renderSlide();
            }
        }

        function toggleControls() {
            document.getElementById('controls').classList.toggle('visible');
        }
    </script>
</body>
</html>